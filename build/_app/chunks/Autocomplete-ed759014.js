import{S as e,i as t,s as n,l,f as o,x as i,R as s,T as c,U as r,u as a,r as u,w as d,Y as h,d as m,e as f,t as p,c as g,a as v,g as w,b as y,D as I,J as F,E as $,k as x,n as N,a7 as b,ag as C,V as k,P as E,ah as T,h as S,af as A,a6 as D,_ as V,$ as _,ai as L,j as O,m as B,o as P,aj as R,v as j,a1 as K}from"./vendor-1a5a643c.js";import{g as M}from"./navigation-51f4a605.js";import{r as U}from"./record-5fc36f15.js";import{e as J}from"./util-eedb8744.js";import"./api-01f7392a.js";import"./singletons-12a22614.js";const q=e=>({noResultsText:2048&e[0]}),G=e=>({noResultsText:e[11]}),H=e=>({createText:8192&e[0]}),z=e=>({createText:e[13]}),Y=e=>({loadingText:4096&e[0]}),Q=e=>({loadingText:e[12]});function W(e,t,n){const l=e.slice();return l[108]=t[n],l[110]=n,l}const X=e=>({item:134217728&e[0],label:134217728&e[0]}),Z=e=>({item:e[108].item,label:e[108].highlighted?e[108].highlighted:e[108].label});function ee(e,t,n){const l=e.slice();return l[111]=t[n],l}const te=e=>({label:2&e[0],item:2&e[0]}),ne=e=>({label:e[34](e[111]),item:e[111],unselectItem:e[41]});function le(e,t,n){const l=e.slice();return l[110]=t[n],l}function oe(e){let t,n=e[1],i=[];for(let l=0;l<n.length;l+=1)i[l]=se(le(e,n,l));return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=l()},l(e){for(let t=0;t<i.length;t+=1)i[t].l(e);t=l()},m(e,n){for(let t=0;t<i.length;t+=1)i[t].m(e,n);o(e,t,n)},p(e,l){if(18&l[0]|8&l[1]){let o;for(n=e[1],o=0;o<n.length;o+=1){const s=le(e,n,o);i[o]?i[o].p(s,l):(i[o]=se(s),i[o].c(),i[o].m(t.parentNode,t))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(e){h(i,e),e&&m(t)}}}function ie(e){let t,n;return{c(){t=f("option"),n=p(e[3]),this.h()},l(l){t=g(l,"OPTION",{class:!0});var o=v(t);n=w(o,e[3]),o.forEach(m),this.h()},h(){t.__value=e[2],t.value=t.__value,t.selected=!0,y(t,"class","svelte-878r4m")},m(e,l){o(e,t,l),I(t,n)},p(e,l){8&l[0]&&S(n,e[3]),4&l[0]&&(t.__value=e[2],t.value=t.__value)},d(e){e&&m(t)}}}function se(e){let t,n,l,i,s=e[34](e[110])+"";return{c(){t=f("option"),n=p(s),l=x(),this.h()},l(e){t=g(e,"OPTION",{class:!0});var o=v(t);n=w(o,s),l=N(o),o.forEach(m),this.h()},h(){t.__value=i=e[4](e[110],!0),t.value=t.__value,t.selected=!0,y(t,"class","svelte-878r4m")},m(e,i){o(e,t,i),I(t,n),I(t,l)},p(e,l){2&l[0]&&s!==(s=e[34](e[110])+"")&&S(n,s),18&l[0]&&i!==(i=e[4](e[110],!0))&&(t.__value=i,t.value=t.__value)},d(e){e&&m(t)}}}function ce(e){let t,n,s=e[1],c=[];for(let l=0;l<s.length;l+=1)c[l]=re(ee(e,s,l));const r=e=>a(c[e],1,1,(()=>{c[e]=null}));return{c(){for(let e=0;e<c.length;e+=1)c[e].c();t=l()},l(e){for(let t=0;t<c.length;t+=1)c[t].l(e);t=l()},m(e,l){for(let t=0;t<c.length;t+=1)c[t].m(e,l);o(e,t,l),n=!0},p(e,n){if(2&n[0]|1032&n[1]|8192&n[2]){let l;for(s=e[1],l=0;l<s.length;l+=1){const o=ee(e,s,l);c[l]?(c[l].p(o,n),i(c[l],1)):(c[l]=re(o),c[l].c(),i(c[l],1),c[l].m(t.parentNode,t))}for(u(),l=s.length;l<c.length;l+=1)r(l);d()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)i(c[e]);n=!0}},o(e){c=c.filter(Boolean);for(let t=0;t<c.length;t+=1)a(c[t]);n=!1},d(e){h(c,e),e&&m(t)}}}function re(e){let t;const n=e[76].tag,l=E(n,e,e[75],ne),u=l||function(e){let t,n,l,i,s,c,r,a,u=e[34](e[111])+"";return{c(){t=f("div"),n=f("span"),l=p(u),i=x(),s=f("span"),c=x(),this.h()},l(e){t=g(e,"DIV",{class:!0});var o=v(t);n=g(o,"SPAN",{class:!0});var r=v(n);l=w(r,u),r.forEach(m),i=N(o),s=g(o,"SPAN",{class:!0}),v(s).forEach(m),o.forEach(m),c=N(e),this.h()},h(){y(n,"class","tag svelte-878r4m"),y(s,"class","tag is-delete svelte-878r4m"),y(t,"class","tags has-addons svelte-878r4m")},m(u,d){o(u,t,d),I(t,n),I(n,l),I(t,i),I(t,s),o(u,c,d),r||(a=F(s,"click",T((function(){D(e[41](e[111]))&&e[41](e[111]).apply(this,arguments)}))),r=!0)},p(t,n){e=t,2&n[0]&&u!==(u=e[34](e[111])+"")&&S(l,u)},d(e){e&&m(t),e&&m(c),r=!1,a()}}}(e);return{c(){u&&u.c()},l(e){u&&u.l(e)},m(e,n){u&&u.m(e,n),t=!0},p(e,o){l?l.p&&(!t||2&o[0]|8192&o[2])&&s(l,n,e,e[75],t?r(n,e[75],o,te):c(e[75]),ne):u&&u.p&&(!t||2&o[0])&&u.p(e,t?o:[-1,-1,-1,-1])},i(e){t||(i(u,e),t=!0)},o(e){a(u,e),t=!1},d(e){u&&u.d(e)}}}function ae(e){let t,n,l,i;return{c(){t=f("span"),n=p("✖"),this.h()},l(e){t=g(e,"SPAN",{class:!0});var l=v(t);n=w(l,"✖"),l.forEach(m),this.h()},h(){y(t,"class","autocomplete-clear-button svelte-878r4m")},m(s,c){o(s,t,c),I(t,n),l||(i=F(t,"click",e[45]),l=!0)},p:$,d(e){e&&m(t),l=!1,i()}}}function ue(e){let t,n;const l=e[76]["no-results"],u=E(l,e,e[75],G),d=u||function(e){let t;return{c(){t=p(e[11])},l(n){t=w(n,e[11])},m(e,n){o(e,t,n)},p(e,n){2048&n[0]&&S(t,e[11])},d(e){e&&m(t)}}}(e);return{c(){t=f("div"),d&&d.c(),this.h()},l(e){t=g(e,"DIV",{class:!0});var n=v(t);d&&d.l(n),n.forEach(m),this.h()},h(){y(t,"class","autocomplete-list-item-no-results svelte-878r4m")},m(e,l){o(e,t,l),d&&d.m(t,null),n=!0},p(e,t){u?u.p&&(!n||2048&t[0]|8192&t[2])&&s(u,l,e,e[75],n?r(l,e[75],t,q):c(e[75]),G):d&&d.p&&(!n||2048&t[0])&&d.p(e,n?t:[-1,-1,-1,-1])},i(e){n||(i(d,e),n=!0)},o(e){a(d,e),n=!1},d(e){e&&m(t),d&&d.d(e)}}}function de(e){let t,n,l,u;const d=e[76].create,h=E(d,e,e[75],z),I=h||function(e){let t;return{c(){t=p(e[13])},l(n){t=w(n,e[13])},m(e,n){o(e,t,n)},p(e,n){8192&n[0]&&S(t,e[13])},d(e){e&&m(t)}}}(e);return{c(){t=f("div"),I&&I.c(),this.h()},l(e){t=g(e,"DIV",{class:!0});var n=v(t);I&&I.l(n),n.forEach(m),this.h()},h(){y(t,"class","autocomplete-list-item-create svelte-878r4m")},m(i,s){o(i,t,s),I&&I.m(t,null),n=!0,l||(u=F(t,"click",e[35]),l=!0)},p(e,t){h?h.p&&(!n||8192&t[0]|8192&t[2])&&s(h,d,e,e[75],n?r(d,e[75],t,H):c(e[75]),z):I&&I.p&&(!n||8192&t[0])&&I.p(e,n?t:[-1,-1,-1,-1])},i(e){n||(i(I,e),n=!0)},o(e){a(I,e),n=!1},d(e){e&&m(t),I&&I.d(e),l=!1,u()}}}function he(e){let t,n;const l=e[76].loading,u=E(l,e,e[75],Q),d=u||function(e){let t;return{c(){t=p(e[12])},l(n){t=w(n,e[12])},m(e,n){o(e,t,n)},p(e,n){4096&n[0]&&S(t,e[12])},d(e){e&&m(t)}}}(e);return{c(){t=f("div"),d&&d.c(),this.h()},l(e){t=g(e,"DIV",{class:!0});var n=v(t);d&&d.l(n),n.forEach(m),this.h()},h(){y(t,"class","autocomplete-list-item-loading svelte-878r4m")},m(e,l){o(e,t,l),d&&d.m(t,null),n=!0},p(e,t){u?u.p&&(!n||4096&t[0]|8192&t[2])&&s(u,l,e,e[75],n?r(l,e[75],t,Y):c(e[75]),Q):d&&d.p&&(!n||4096&t[0])&&d.p(e,n?t:[-1,-1,-1,-1])},i(e){n||(i(d,e),n=!0)},o(e){a(d,e),n=!1},d(e){e&&m(t),d&&d.d(e)}}}function me(e){let t,n,s,c=e[27],r=[];for(let l=0;l<c.length;l+=1)r[l]=we(W(e,c,l));const f=e=>a(r[e],1,1,(()=>{r[e]=null}));let p=e[5]>0&&e[27].length>e[5]&&ye(e);return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=x(),p&&p.c(),n=l()},l(e){for(let t=0;t<r.length;t+=1)r[t].l(e);t=N(e),p&&p.l(e),n=l()},m(e,l){for(let t=0;t<r.length;t+=1)r[t].m(e,l);o(e,t,l),p&&p.m(e,l),o(e,n,l),s=!0},p(e,l){if(201326624&l[0]|32800&l[1]|8192&l[2]){let n;for(c=e[27],n=0;n<c.length;n+=1){const o=W(e,c,n);r[n]?(r[n].p(o,l),i(r[n],1)):(r[n]=we(o),r[n].c(),i(r[n],1),r[n].m(t.parentNode,t))}for(u(),n=c.length;n<r.length;n+=1)f(n);d()}e[5]>0&&e[27].length>e[5]?p?p.p(e,l):(p=ye(e),p.c(),p.m(n.parentNode,n)):p&&(p.d(1),p=null)},i(e){if(!s){for(let e=0;e<c.length;e+=1)i(r[e]);s=!0}},o(e){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)a(r[t]);s=!1},d(e){h(r,e),e&&m(t),p&&p.d(e),e&&m(n)}}}function fe(e){let t,n,s=e[108]&&pe(e);return{c(){s&&s.c(),t=l()},l(e){s&&s.l(e),t=l()},m(e,l){s&&s.m(e,l),o(e,t,l),n=!0},p(e,n){e[108]?s?(s.p(e,n),134217728&n[0]&&i(s,1)):(s=pe(e),s.c(),i(s,1),s.m(t.parentNode,t)):s&&(u(),a(s,1,1,(()=>{s=null})),d())},i(e){n||(i(s),n=!0)},o(e){a(s),n=!1},d(e){s&&s.d(e),e&&m(t)}}}function pe(e){let t,n,u,d,h;const p=e[76].item,w=E(p,e,e[75],Z),I=w||function(e){let t;function n(e,t){return e[108].highlighted?ve:ge}let i=n(e),s=i(e);return{c(){s.c(),t=l()},l(e){s.l(e),t=l()},m(e,n){s.m(e,n),o(e,t,n)},p(e,l){i===(i=n(e))&&s?s.p(e,l):(s.d(1),s=i(e),s&&(s.c(),s.m(t.parentNode,t)))},d(e){s.d(e),e&&m(t)}}}(e);function $(){return e[79](e[108])}function x(){return e[80](e[110])}return{c(){t=f("div"),I&&I.c(),this.h()},l(e){t=g(e,"DIV",{class:!0});var n=v(t);I&&I.l(n),n.forEach(m),this.h()},h(){y(t,"class",n="autocomplete-list-item "+(e[110]===e[26]?"selected":"")+" svelte-878r4m"),b(t,"confirmed",e[46](e[108].item))},m(e,n){o(e,t,n),I&&I.m(t,null),u=!0,d||(h=[F(t,"click",$),F(t,"pointerenter",x)],d=!0)},p(l,o){e=l,w?w.p&&(!u||134217728&o[0]|8192&o[2])&&s(w,p,e,e[75],u?r(p,e[75],o,X):c(e[75]),Z):I&&I.p&&(!u||134217728&o[0])&&I.p(e,u?o:[-1,-1,-1,-1]),(!u||67108864&o[0]&&n!==(n="autocomplete-list-item "+(e[110]===e[26]?"selected":"")+" svelte-878r4m"))&&y(t,"class",n),201326592&o[0]|32768&o[1]&&b(t,"confirmed",e[46](e[108].item))},i(e){u||(i(I,e),u=!0)},o(e){a(I,e),u=!1},d(e){e&&m(t),I&&I.d(e),d=!1,k(h)}}}function ge(e){let t,n,i=e[108].label+"";return{c(){t=new V,n=l(),this.h()},l(e){t=_(e),n=l(),this.h()},h(){t.a=n},m(e,l){t.m(i,e,l),o(e,n,l)},p(e,n){134217728&n[0]&&i!==(i=e[108].label+"")&&t.p(i)},d(e){e&&m(n),e&&t.d()}}}function ve(e){let t,n,i=e[108].highlighted+"";return{c(){t=new V,n=l(),this.h()},l(e){t=_(e),n=l(),this.h()},h(){t.a=n},m(e,l){t.m(i,e,l),o(e,n,l)},p(e,n){134217728&n[0]&&i!==(i=e[108].highlighted+"")&&t.p(i)},d(e){e&&m(n),e&&t.d()}}}function we(e){let t,n,s=e[108]&&(e[5]<=0||e[110]<e[5])&&fe(e);return{c(){s&&s.c(),t=l()},l(e){s&&s.l(e),t=l()},m(e,l){s&&s.m(e,l),o(e,t,l),n=!0},p(e,n){e[108]&&(e[5]<=0||e[110]<e[5])?s?(s.p(e,n),134217760&n[0]&&i(s,1)):(s=fe(e),s.c(),i(s,1),s.m(t.parentNode,t)):s&&(u(),a(s,1,1,(()=>{s=null})),d())},i(e){n||(i(s),n=!0)},o(e){a(s),n=!1},d(e){s&&s.d(e),e&&m(t)}}}function ye(e){let t,n,l,i,s=e[27].length-e[5]+"";return{c(){t=f("div"),n=p("..."),l=p(s),i=p(" results not shown"),this.h()},l(e){t=g(e,"DIV",{class:!0});var o=v(t);n=w(o,"..."),l=w(o,s),i=w(o," results not shown"),o.forEach(m),this.h()},h(){y(t,"class","autocomplete-list-item-no-results svelte-878r4m")},m(e,s){o(e,t,s),I(t,n),I(t,l),I(t,i)},p(e,t){134217760&t[0]&&s!==(s=e[27].length-e[5]+"")&&S(l,s)},d(e){e&&m(t)}}}function Ie(e){let t,n,l,s,c,r,h,p,w,$,E,T,S,A,D,V,_,L,O,B;function P(e,t){return!e[6]&&e[2]?ie:e[6]&&e[1]?oe:void 0}let R=P(e),j=R&&R(e),K=e[6]&&e[1]&&ce(e),M=e[31]&&ae(e);const U=[me,he,de,ue],J=[];function q(e,t){return e[27]&&e[27].length>0?0:e[30]&&e[12]?1:e[7]?2:e[11]?3:-1}return~(A=q(e))&&(D=J[A]=U[A](e)),{c(){t=f("div"),n=f("select"),j&&j.c(),l=x(),s=f("div"),K&&K.c(),c=x(),r=f("input"),E=x(),M&&M.c(),T=x(),S=f("div"),D&&D.c(),this.h()},l(e){t=g(e,"DIV",{class:!0});var o=v(t);n=g(o,"SELECT",{name:!0,id:!0,class:!0});var i=v(n);j&&j.l(i),i.forEach(m),l=N(o),s=g(o,"DIV",{class:!0});var a=v(s);K&&K.l(a),c=N(a),r=g(a,"INPUT",{type:!0,class:!0,id:!0,autocomplete:!0,placeholder:!0,name:!0,title:!0}),E=N(a),M&&M.l(a),a.forEach(m),T=N(o),S=g(o,"DIV",{class:!0});var u=v(S);D&&D.l(u),u.forEach(m),o.forEach(m),this.h()},h(){y(n,"name",e[19]),y(n,"id",e[20]),n.multiple=e[6],y(n,"class","svelte-878r4m"),y(r,"type","text"),y(r,"class",h=(e[16]?e[16]:"")+" input autocomplete-input svelte-878r4m"),y(r,"id",p=e[17]?e[17]:""),y(r,"autocomplete",w=e[22]?"on":"off"),y(r,"placeholder",e[14]),y(r,"name",e[18]),r.disabled=e[25],y(r,"title",e[21]),r.readOnly=$=e[23]||e[8]&&e[1],y(s,"class","input-container svelte-878r4m"),y(S,"class",V=(e[24]?e[24]:"")+" autocomplete-list "+(e[32]?"":"hidden")+" is-fullwidth svelte-878r4m"),y(t,"class",_=(e[15]?e[15]:"")+" "+(e[9]||!e[0].length?"hide-arrow":"")+" "+(e[6]?"is-multiple":"")+" autocomplete select is-fullwidth "+e[33]+" svelte-878r4m"),b(t,"show-clear",e[31]),b(t,"is-loading",e[10]&&e[30])},m(i,a){o(i,t,a),I(t,n),j&&j.m(n,null),I(t,l),I(t,s),K&&K.m(s,null),I(s,c),I(s,r),e[77](r),C(r,e[3]),I(s,E),M&&M.m(s,null),I(t,T),I(t,S),~A&&J[A].m(S,null),e[81](S),L=!0,O||(B=[F(window,"click",e[37]),F(r,"input",e[78]),F(r,"input",e[40]),F(r,"focus",e[43]),F(r,"blur",e[44]),F(r,"keydown",e[38]),F(r,"click",e[42]),F(r,"keypress",e[39])],O=!0)},p(e,l){R===(R=P(e))&&j?j.p(e,l):(j&&j.d(1),j=R&&R(e),j&&(j.c(),j.m(n,null))),(!L||524288&l[0])&&y(n,"name",e[19]),(!L||1048576&l[0])&&y(n,"id",e[20]),(!L||64&l[0])&&(n.multiple=e[6]),e[6]&&e[1]?K?(K.p(e,l),66&l[0]&&i(K,1)):(K=ce(e),K.c(),i(K,1),K.m(s,c)):K&&(u(),a(K,1,1,(()=>{K=null})),d()),(!L||65536&l[0]&&h!==(h=(e[16]?e[16]:"")+" input autocomplete-input svelte-878r4m"))&&y(r,"class",h),(!L||131072&l[0]&&p!==(p=e[17]?e[17]:""))&&y(r,"id",p),(!L||4194304&l[0]&&w!==(w=e[22]?"on":"off"))&&y(r,"autocomplete",w),(!L||16384&l[0])&&y(r,"placeholder",e[14]),(!L||262144&l[0])&&y(r,"name",e[18]),(!L||33554432&l[0])&&(r.disabled=e[25]),(!L||2097152&l[0])&&y(r,"title",e[21]),(!L||8388866&l[0]&&$!==($=e[23]||e[8]&&e[1]))&&(r.readOnly=$),8&l[0]&&r.value!==e[3]&&C(r,e[3]),e[31]?M?M.p(e,l):(M=ae(e),M.c(),M.m(s,null)):M&&(M.d(1),M=null);let o=A;A=q(e),A===o?~A&&J[A].p(e,l):(D&&(u(),a(J[o],1,1,(()=>{J[o]=null})),d()),~A?(D=J[A],D?D.p(e,l):(D=J[A]=U[A](e),D.c()),i(D,1),D.m(S,null)):D=null),(!L||16777216&l[0]|2&l[1]&&V!==(V=(e[24]?e[24]:"")+" autocomplete-list "+(e[32]?"":"hidden")+" is-fullwidth svelte-878r4m"))&&y(S,"class",V),(!L||33345&l[0]&&_!==(_=(e[15]?e[15]:"")+" "+(e[9]||!e[0].length?"hide-arrow":"")+" "+(e[6]?"is-multiple":"")+" autocomplete select is-fullwidth "+e[33]+" svelte-878r4m"))&&y(t,"class",_),33345&l[0]|1&l[1]&&b(t,"show-clear",e[31]),1073776193&l[0]&&b(t,"is-loading",e[10]&&e[30])},i(e){L||(i(K),i(D),L=!0)},o(e){a(K),a(D),L=!1},d(n){n&&m(t),j&&j.d(),K&&K.d(),e[77](null),M&&M.d(),~A&&J[A].d(),e[81](null),O=!1,k(B)}}}function Fe(e,t){let n;"function"!=typeof e&&console.error("Not a function: "+e+", argument: "+t);try{n=e(t)}catch(o){console.warn("Error executing Autocomplete function on value: "+t+" function: "+e)}let l=n;return null==l&&(l=""),"string"!=typeof l&&(l=l.toString()),l}function $e(e,t){if(!e)return 0;const n=e.keywords;let l=0;return t.forEach((e=>{n.includes(e)&&l++})),l}function xe(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function Ne(e,t,n){let l,o,{$$slots:i={},$$scope:s}=t,{items:c=[]}=t,{searchFunction:r=!1}=t,{labelFieldName:a}=t,{keywordsFieldName:u=a}=t,{valueFieldName:d}=t,{labelFunction:h=function(e){return null==e?"":a?e[a]:e}}=t,{keywordsFunction:m=function(e){return null==e?"":u?e[u]:h(e)}}=t,{valueFunction:f=function(e,t=!1){return null==e?e:!b||t?d?e[d]:e:e.map((e=>d?e[d]:e))}}=t,{keywordsCleanFunction:p=function(e){return e}}=t,{textCleanFunction:g=function(e){return e}}=t,{beforeChange:v=function(e,t){return!0}}=t,{onChange:w=function(e){}}=t,{onFocus:y=function(){}}=t,{onBlur:I=function(){}}=t,{onCreate:F=function(e){ee&&console.log("onCreate: "+e)}}=t,{selectFirstIfEmpty:$=!1}=t,{minCharactersToSearch:x=1}=t,{maxItemsToShowInList:N=0}=t,{multiple:b=!1}=t,{create:C=!1}=t,{ignoreAccents:k=!0}=t,{matchAllKeywords:E=!0}=t,{sortByMatchedKeywords:T=!1}=t,{itemFilterFunction:S}=t,{itemSortFunction:D}=t,{lock:V=!1}=t,{delay:_=0}=t,{localFiltering:L=!0}=t,{hideArrow:O=!1}=t,{showClear:B=!1}=t,{showLoadingIndicator:P=!1}=t,{noResultsText:R="No results found"}=t,{loadingText:j="Loading results..."}=t,{createText:K="Not found, add anyway?"}=t,{placeholder:M}=t,{className:U}=t,{inputClassName:J}=t,{inputId:q}=t,{name:G}=t,{selectName:H}=t,{selectId:z}=t,{title:Y}=t,{html5autocomplete:Q}=t,{readonly:W}=t,{dropdownClassName:X}=t,{disabled:Z=!1}=t,{debug:ee=!1}=t,{selectedItem:te}=t,{value:ne}=t,{highlightedItem:le}=t;const oe="sautocomplete-"+Math.floor(1e3*Math.random());let ie,se,ce,re,ae=!1,ue=!1,de=-1,{text:he}=t,me=0,fe=[],pe=0,ge=0;function ve(e){return Fe(h,e)}function we(e){const t=Fe(m,e);let n=Fe(p,t);return n=n.toLowerCase().trim(),k&&(n=xe(n)),ee&&console.log("Extracted keywords: '"+n+"' from item: "+JSON.stringify(e)),n}function ye(){let e;ee&&(e="Autocomplete prepare list "+(q?`(id: ${q})`:""),console.time(e),console.log("Prepare items to search"),console.log("items: "+JSON.stringify(c))),Array.isArray(c)||(console.warn("Autocomplete items / search function did not return array but",c),n(0,c=[]));const t=c?c.length:0;fe=new Array(t),t>0&&c.forEach(((e,t)=>{const n=function(e){return{keywords:we(e),label:ve(e),item:e}}(e);null==n&&console.log("Undefined item for: ",e),fe[t]=n})),ee&&(console.log(fe.length+" items to search"),console.timeEnd(e))}async function Ie(){let e;ee&&(e=`Autocomplete search ${q?`(id: ${q})`:""})`,console.time(e),console.log("Searching user entered text: '"+he+"'"));const t=function(e){if(null==e)return"";const t=e.replace(/[&/\\#,+()$~%.'":*?<>{}]/g," ").trim();if(n(74,me=t.length),x>1&&me<x)return"";const l=g(t).toLowerCase().trim();return ee&&console.log("Change user entered text '"+e+"' into '"+l+"'"),l}(he);if(""===t)return r?(n(0,c=[]),ee&&console.log("User entered text is empty clear list of items")):(n(27,ce=fe),ee&&console.log("User entered text is empty set the list of items to all items")),je(),void(ee&&console.timeEnd(e));if(r){pe+=1;const e=pe;if(n(30,ue=!0),"AsyncGeneratorFunction"===r.constructor.name){for await(const l of r(t)){if(e<ge)return!1;e>ge&&n(0,c=[]),ge=e,n(0,c=[...c,...l]),Ne(t)}ge<e&&(ge=e,n(0,c=[]),Ne(t))}else{let l=await r(t);if(e<ge)return!1;ge=e,n(0,c=l),Ne(t)}n(30,ue=!1)}else Ne(t);ee&&(console.timeEnd(e),console.log("Search found "+ce.length+" items"))}function Ne(e){ye();const t=(k?xe(e):e).split(/\s+/g);let l;L?(l=S?fe.filter((e=>S(e.item,t))):fe.filter((e=>function(e,t){var n=$e(e,t);return E?n>=t.length:n>0}(e,t))),D?l=l.sort(((e,n)=>D(e.item,n.item,t))):T&&(l=l.sort(((e,n)=>function(e,t,n){return $e(t,n)-$e(e,n)}(e,n,t))))):l=fe;const o=Ke(t,"label"),i=l.map(o);return n(27,ce=i),je(),!0}function be(e){if(ee&&console.log("selectListItem",e),void 0===e&&C){const t=F(he);if(void 0!==t){ye(),n(27,ce=fe);const l=Oe(t,ce);l>=0&&(n(26,de=l),e=ce[de])}}if(void 0===e)return ee&&console.log("listItem is undefined. Can not select."),!1;const t=e.item;return v(te,t)&&(b?te?te.includes(t)?n(1,te=te.filter((e=>e!==t))):n(1,te=[...te,t]):n(1,te=[t]):(n(1,te=void 0),n(1,te=t))),!0}function Ce(){ee&&console.log("selectItem",de);be(ce[de])&&(Pe(),b&&ie.focus())}function ke(){ee&&console.log("up"),Be(),de>0&&n(26,de--,de),Te()}function Ee(){ee&&console.log("down"),Be(),de<ce.length-1&&n(26,de++,de),Te()}function Te(){ee&&console.log("highlight");const e=".selected";ee&&console.log("Seaching DOM element: .selected in "+se);const t=se&&se.querySelector(e);t?"function"==typeof t.scrollIntoViewIfNeeded?(ee&&console.log("Scrolling selected item into view"),t.scrollIntoViewIfNeeded()):ee&&console.warn("Could not scroll selected item into view, scrollIntoViewIfNeeded not supported"):ee&&console.warn("Selected item not found to scroll into view")}function Se(e){ee&&console.log("onListItemClick"),be(e)&&(Pe(),b&&ie.focus())}function Ae(e){ee&&console.log("unselectItem",e),n(1,te=te.filter((t=>t!==e))),ie.focus()}function De(){Ie()&&(n(26,de=0),Be())}function Ve(e){ee&&console.log("onEsc"),e.stopPropagation(),ae&&(ie.focus(),Pe())}function _e(e){ee&&console.log("onBackspace"),Ae(te[te.length-1])}function Le(){if(ee&&console.log("resetListToAllItemsAndOpen"),he?!fe.length&&te&&r&&Ie():n(27,ce=fe),Be(),te){ee&&console.log("Searching currently selected item: "+JSON.stringify(te));const e=Oe(te,ce);e>=0&&(n(26,de=e),Te())}}function Oe(e,t){ee&&console.log("Finding index for item",e);let n=-1;for(let l=0;l<t.length;l++){const o=t[l];if(void 0!==o){if(ee&&console.log("Item "+l+": "+JSON.stringify(o)),e==o.item){n=l;break}}else ee&&console.log(`listItem ${l} is undefined. Skipping.`)}return ee&&(n>=0?console.log("Found index for item: "+n):console.warn("Not found index for item: "+e)),n}function Be(){ee&&console.log("open"),Re()||n(73,ae=!0)}function Pe(){ee&&console.log("close"),n(73,ae=!1),n(30,ue=!1),!he&&$&&(n(26,de=0),Ce())}function Re(){return x>1&&me<x}function je(){Re()&&Pe()}function Ke(e,t){return n=>{let l=n[t];const o=Object.assign({highlighted:void 0},n);o.highlighted=l;const i=l.toLowerCase(),s=k?xe(i):i;if(e&&e.length){const t=[];for(let n=0;n<e.length;n++){let l=e[n];k&&(l=xe(l));const o=l.length;let i=0;do{if(i=s.indexOf(l,i),i>=0){let e=i+o;t.push([i,e]),i=e}}while(-1!==i)}if(t.length>0){const e=new Set;for(let n=0;n<t.length;n++){const l=t[n],o=l[0],s=l[1],c=i.substring(o,s);e.add(c)}for(let t of e){if("b"===t)continue;const e=new RegExp("("+t+")","ig"),n=o.highlighted.replace(e,"<b>$1</b>");o.highlighted=n}}}return o}}return e.$$set=e=>{"items"in e&&n(0,c=e.items),"searchFunction"in e&&n(48,r=e.searchFunction),"labelFieldName"in e&&n(49,a=e.labelFieldName),"keywordsFieldName"in e&&n(50,u=e.keywordsFieldName),"valueFieldName"in e&&n(51,d=e.valueFieldName),"labelFunction"in e&&n(52,h=e.labelFunction),"keywordsFunction"in e&&n(53,m=e.keywordsFunction),"valueFunction"in e&&n(4,f=e.valueFunction),"keywordsCleanFunction"in e&&n(54,p=e.keywordsCleanFunction),"textCleanFunction"in e&&n(55,g=e.textCleanFunction),"beforeChange"in e&&n(56,v=e.beforeChange),"onChange"in e&&n(57,w=e.onChange),"onFocus"in e&&n(58,y=e.onFocus),"onBlur"in e&&n(59,I=e.onBlur),"onCreate"in e&&n(60,F=e.onCreate),"selectFirstIfEmpty"in e&&n(61,$=e.selectFirstIfEmpty),"minCharactersToSearch"in e&&n(62,x=e.minCharactersToSearch),"maxItemsToShowInList"in e&&n(5,N=e.maxItemsToShowInList),"multiple"in e&&n(6,b=e.multiple),"create"in e&&n(7,C=e.create),"ignoreAccents"in e&&n(63,k=e.ignoreAccents),"matchAllKeywords"in e&&n(64,E=e.matchAllKeywords),"sortByMatchedKeywords"in e&&n(65,T=e.sortByMatchedKeywords),"itemFilterFunction"in e&&n(66,S=e.itemFilterFunction),"itemSortFunction"in e&&n(67,D=e.itemSortFunction),"lock"in e&&n(8,V=e.lock),"delay"in e&&n(68,_=e.delay),"localFiltering"in e&&n(69,L=e.localFiltering),"hideArrow"in e&&n(9,O=e.hideArrow),"showClear"in e&&n(70,B=e.showClear),"showLoadingIndicator"in e&&n(10,P=e.showLoadingIndicator),"noResultsText"in e&&n(11,R=e.noResultsText),"loadingText"in e&&n(12,j=e.loadingText),"createText"in e&&n(13,K=e.createText),"placeholder"in e&&n(14,M=e.placeholder),"className"in e&&n(15,U=e.className),"inputClassName"in e&&n(16,J=e.inputClassName),"inputId"in e&&n(17,q=e.inputId),"name"in e&&n(18,G=e.name),"selectName"in e&&n(19,H=e.selectName),"selectId"in e&&n(20,z=e.selectId),"title"in e&&n(21,Y=e.title),"html5autocomplete"in e&&n(22,Q=e.html5autocomplete),"readonly"in e&&n(23,W=e.readonly),"dropdownClassName"in e&&n(24,X=e.dropdownClassName),"disabled"in e&&n(25,Z=e.disabled),"debug"in e&&n(71,ee=e.debug),"selectedItem"in e&&n(1,te=e.selectedItem),"value"in e&&n(2,ne=e.value),"highlightedItem"in e&&n(47,le=e.highlightedItem),"text"in e&&n(3,he=e.text),"$$scope"in e&&n(75,s=e.$$scope)},e.$$.update=()=>{2&e.$$.dirty[0]&&(n(2,ne=f(te)),n(3,he=b?"":ve(te)),n(27,ce=fe),w(te)),201326592&e.$$.dirty[0]&&n(47,le=ce&&de&&de>=0&&de<ce.length?ce[de].item:null),1&e.$$.dirty[0]|6144&e.$$.dirty[2]&&n(32,l=ae&&(c&&c.length>0||me>0)),322&e.$$.dirty[0]|256&e.$$.dirty[2]&&n(31,o=B||(V||b)&&te),1&e.$$.dirty[0]&&ye()},[c,te,ne,he,f,N,b,C,V,O,P,R,j,K,M,U,J,q,G,H,z,Y,Q,W,X,Z,de,ce,ie,se,ue,o,l,oe,ve,Ce,Se,function(e){ee&&console.log("onDocumentClick: "+JSON.stringify(e.target)),e.target.closest("."+oe)?(ee&&console.log("onDocumentClick inside"),Te()):(ee&&console.log("onDocumentClick outside"),Pe())},function(e){ee&&console.log("onKeyDown");let t=e.key;"Tab"===t&&e.shiftKey&&(t="ShiftTab");const n={Tab:ae?Ee.bind(this):null,ShiftTab:ae?ke.bind(this):null,ArrowDown:Ee.bind(this),ArrowUp:ke.bind(this),Escape:Ve.bind(this),Backspace:b&&te&&te.length&&!he?_e.bind(this):null}[t];"function"==typeof n&&(e.preventDefault(),n(e))},function(e){ee&&console.log("onKeyPress"),"Enter"===e.key&&ae&&(e.preventDefault(),Ce())},function(e){ee&&console.log("onInput"),n(3,he=e.target.value),re&&clearTimeout(re),_?re=setTimeout(De,_):De()},Ae,function(){ee&&console.log("onInputClick"),Le()},function(){ee&&console.log("onFocus"),y(),Le()},function(){ee&&console.log("onBlur"),I()},function(){ee&&console.log("clear"),n(3,he=""),n(1,te=void 0),setTimeout((()=>{ie.focus(),Pe()}))},function(e){return!!te&&(b?te.includes(e):e==te)},le,r,a,u,d,h,m,p,g,v,w,y,I,F,$,x,k,E,T,S,D,_,L,B,ee,Ke,ae,me,s,i,function(e){A[e?"unshift":"push"]((()=>{ie=e,n(28,ie)}))},function(){he=this.value,n(3,he)},e=>Se(e),e=>{n(26,de=e)},function(e){A[e?"unshift":"push"]((()=>{se=e,n(29,se)}))}]}class be extends e{constructor(e){super(),t(this,e,Ne,Ie,n,{items:0,searchFunction:48,labelFieldName:49,keywordsFieldName:50,valueFieldName:51,labelFunction:52,keywordsFunction:53,valueFunction:4,keywordsCleanFunction:54,textCleanFunction:55,beforeChange:56,onChange:57,onFocus:58,onBlur:59,onCreate:60,selectFirstIfEmpty:61,minCharactersToSearch:62,maxItemsToShowInList:5,multiple:6,create:7,ignoreAccents:63,matchAllKeywords:64,sortByMatchedKeywords:65,itemFilterFunction:66,itemSortFunction:67,lock:8,delay:68,localFiltering:69,hideArrow:9,showClear:70,showLoadingIndicator:10,noResultsText:11,loadingText:12,createText:13,placeholder:14,className:15,inputClassName:16,inputId:17,name:18,selectName:19,selectId:20,title:21,html5autocomplete:22,readonly:23,dropdownClassName:24,disabled:25,debug:71,selectedItem:1,value:2,highlightedItem:47,text:3,highlightFilter:72},null,[-1,-1,-1,-1])}get highlightFilter(){return this.$$.ctx[72]}}function Ce(e){let t,n=e[10].images.length>0&&ke(e);return{c(){t=f("div"),n&&n.c(),this.h()},l(e){t=g(e,"DIV",{class:!0});var l=v(t);n&&n.l(l),l.forEach(m),this.h()},h(){y(t,"class","w-10 h-8 overflow-hidden rounded-md")},m(e,l){o(e,t,l),n&&n.m(t,null)},p(e,l){e[10].images.length>0?n?n.p(e,l):(n=ke(e),n.c(),n.m(t,null)):n&&(n.d(1),n=null)},d(e){e&&m(t),n&&n.d()}}}function ke(e){let t,n,l;return{c(){t=f("div"),n=f("img"),this.h()},l(e){t=g(e,"DIV",{class:!0});var l=v(t);n=g(l,"IMG",{src:!0,width:!0}),l.forEach(m),this.h()},h(){K(n.src,l=`https://api.finna.fi${e[10].images[0]}`)||y(n,"src",l),y(n,"width",40),y(t,"class","mr-1")},m(e,l){o(e,t,l),I(t,n)},p(e,t){1024&t&&!K(n.src,l=`https://api.finna.fi${e[10].images[0]}`)&&y(n,"src",l)},d(e){e&&m(t)}}}function Ee(e){let t,n,l,i,s,c,r=e[10].title+"",a=0!==e[10].id&&Ce(e);return{c(){t=f("span"),n=f("div"),a&&a.c(),l=x(),i=f("div"),s=f("div"),c=p(r),this.h()},l(e){t=g(e,"SPAN",{slot:!0});var o=v(t);n=g(o,"DIV",{class:!0});var u=v(n);a&&a.l(u),l=N(u),i=g(u,"DIV",{class:!0});var d=v(i);s=g(d,"DIV",{class:!0});var h=v(s);c=w(h,r),h.forEach(m),d.forEach(m),u.forEach(m),o.forEach(m),this.h()},h(){y(s,"class","text-md overflow-clip line-clamp-1"),y(i,"class","pl-1"),y(n,"class","flex items-center"),y(t,"slot","item")},m(e,r){o(e,t,r),I(t,n),a&&a.m(n,null),I(n,l),I(n,i),I(i,s),I(s,c)},p(e,t){0!==e[10].id?a?a.p(e,t):(a=Ce(e),a.c(),a.m(n,l)):a&&(a.d(1),a=null),1024&t&&r!==(r=e[10].title+"")&&S(c,r)},d(e){e&&m(t),a&&a.d()}}}function Te(e){let t,n,l,s,c;function r(t){e[6](t)}function u(t){e[7](t)}let d={class:"w-full",placeholder:"Hae...",noResultsText:`Ei tuloksia hakusanalla ${e[2]}`,createText:`Ei tuloksia hakusanalla ${e[2]}`,delay:"300",searchFunction:e[3],showLoadingIndicator:!0,create:!0,onCreate:e[5],localFiltering:!1,labelFieldName:"title",loadingText:"Haetaan...",$$slots:{item:[Ee,({label:e,item:t})=>({9:e,10:t}),({label:e,item:t})=>(e?512:0)|(t?1024:0)]},$$scope:{ctx:e}};return void 0!==e[0]&&(d.selectedItem=e[0]),void 0!==e[2]&&(d.text=e[2]),n=new be({props:d}),A.push((()=>L(n,"selectedItem",r))),A.push((()=>L(n,"text",u))),{c(){t=f("div"),O(n.$$.fragment),this.h()},l(e){t=g(e,"DIV",{id:!0,class:!0});var l=v(t);B(n.$$.fragment,l),l.forEach(m),this.h()},h(){y(t,"id","autocomplete"),y(t,"class","svelte-15q28p1")},m(e,l){o(e,t,l),P(n,t,null),c=!0},p(e,[t]){const o={};4&t&&(o.noResultsText=`Ei tuloksia hakusanalla ${e[2]}`),4&t&&(o.createText=`Ei tuloksia hakusanalla ${e[2]}`),2&t&&(o.onCreate=e[5]),3072&t&&(o.$$scope={dirty:t,ctx:e}),!l&&1&t&&(l=!0,o.selectedItem=e[0],R((()=>l=!1))),!s&&4&t&&(s=!0,o.text=e[2],R((()=>s=!1))),n.$set(o)},i(e){c||(i(n.$$.fragment,e),c=!0)},o(e){a(n.$$.fragment,e),c=!1},d(e){e&&m(t),j(n)}}}function Se(e,t,n){var l=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))((function(o,i){function s(e){try{r(l.next(e))}catch(t){i(t)}}function c(e){try{r(l.throw(e))}catch(t){i(t)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}r((l=l.apply(e,t||[])).next())}))};let o,i,{closeSearch:s}=t,c=null;return e.$$set=e=>{"closeSearch"in e&&n(4,s=e.closeSearch)},e.$$.update=()=>{if(21&e.$$.dirty&&null!==c&&(0===c.id?n(1,o=i):M(U(c.id)),s()),18&e.$$.dirty&&o&&""!==o){const e=window.location,t=new URL(`${e.protocol}//${e.host}/search`);t.searchParams.set("lookfor",o),M(t.toString()),s()}},[c,o,i,function(e){return l(this,void 0,void 0,(function*(){const t=`/api/autocomplete/results.json?lookfor=${encodeURIComponent(e)}`,n=yield fetch(t),l=yield n.json();if(!l||0===Number(l.resultCount))return[];const o=J(l.records);return[{id:0,title:`Näytä kaikki haulla ${e} (${o.length})`},...o]}))},s,e=>n(1,o=e),function(e){c=e,n(0,c)},function(e){i=e,n(2,i)}]}class Ae extends e{constructor(e){super(),t(this,e,Se,Te,n,{closeSearch:4})}}export{Ae as default};
